
/**
 * Module dependencies.
 */

var exec = require('child_process').exec;

module.exports = function(path, fn){
  exec('gm identify -format %[EXIF:*] "' + path + '"', function(err, stdout){
    if (err) return fn(err);
    if ('' == stdout) return fn();
    fn(null, parse(stdout));
  });
};

function parse(str) {
  return str.split('\n').reduce(function(obj, line){
    line = line.split('=');
    var key = line[0];
    var val = line[1];
    if (/^\d+$/.test(val)) val = parseInt(val, 10);
    if ('' != key) obj[key] = val;
    return obj;
  }, {});
}